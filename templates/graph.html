<!DOCTYPE HTML>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Poloniex vs Bitfinex</title>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script type="text/javascript">
var seriesOptions = [],
    seriesCounter = 0,
    names = ['BTC-finex', 'BTC-polo', 'ETH-finex', 'ETH-polo'];

/**
 * Create the chart when all data is loaded
 * @returns {undefined}
 */
function createChart() {
    Highcharts.setOptions({
        global: { useUTC: false }
    });
    Highcharts.stockChart('container', {
        title: { 
            text: "BTC and ETH, Poloniex vs Bitfinex"
        },
        rangeSelector: {
            buttons: [{
                count: 1,
                type: 'hour',
                text: '1h'
            }, {
                count: 1,
                type: 'day',
                text: '1d'
            }, {
                count: 1,
                type: 'week',
                text: '1w'
            }, {
                type: 'all',
                text: 'All'
            }],
        },
        yAxis: {
            title: { 
                text: "Best rate (%)"
            },
            plotLines: [{
                value: 0,
                width: 2,
                color: 'silver'
            }]
        },
        plotOptions: {
            series: {
                showInNavigator: true
            }
        },
        tooltip: {
            pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',
            valueDecimals: 5,
            split: true
        },
        series: seriesOptions
    });
}

$.each(names, function (i, name) {
    $.getJSON('/crypto-graph/' + name.toLowerCase() + '.json', function (data) {
            for (var k in data) {
                data[k][0] *= 1000;
            };
            console.log(data)
            seriesOptions[i] = {
                name: name,
                data: data
            };
            // As we're loading the data asynchronously, we don't know what order it will arrive. So
            // we keep a counter and create the chart when all the data is loaded.
            seriesCounter += 1;
            if (seriesCounter === names.length) {
                createChart();
            }
            });
});
        </script>
    </head>
    <body>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="https://code.highcharts.com/stock/highstock.js"></script>
        <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
        <div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
    </body>
</html>
